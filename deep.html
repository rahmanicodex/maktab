<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ú©ØªØ¨ Ø§ÙØºØ§Ù†</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap" rel="stylesheet" />
  <style>
    * {
      font-family: 'Vazirmatn', sans-serif;
    }
    body {
      background: url('https://images.unsplash.com/photo-1577896851231-70ef18881754?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container, .admin-panel, .teacher-panel, .parent-panel {
      background-color: rgba(255,255,255,0.95);
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      text-align: center;
    }
    h1, h2, h3 {
      color: #1d3557;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 10px;
      background-color: #1d3557;
      color: white;
      border: none;
      border-radius: 10px;
      margin-top: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0d1c34;
    }
    .hidden {
      display: none;
    }
    .record {
      background: #f8f9fa;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-top: 10px;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container" id="login-panel">
    <h1>Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª (Ù†Ø§Ù… Ù…Ú©ØªØ¨)</h1>
    <select id="userTypeSelect">
      <option value="admin">Ù…Ø¯ÛŒØ±</option>
      <option value="teacher">Ù…Ø¹Ù„Ù…</option>
      <option value="parent">ÙˆØ§Ù„Ø¯ÛŒÙ†</option>
    </select>
    <input type="text" id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" />
    <input type="password" id="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />
    <button onclick="handleLogin()">ÙˆØ±ÙˆØ¯</button>
  </div>

  <div class="admin-panel hidden" id="admin-panel">
    <h2>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
    <h3>Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø¹Ù„Ù…</h3>
    <input type="text" id="teacherUser" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ø¹Ù„Ù…" />
    <input type="password" id="teacherPass" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¹Ù„Ù…" />
    <button onclick="registerSpecificUser('teacher')">Ø«Ø¨Øª Ù…Ø¹Ù„Ù…</button>

    <h3>Ø§ÙØ²ÙˆØ¯Ù† ÙˆØ§Ù„Ø¯</h3>
    <input type="text" id="parentUser" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ù„Ø¯" />
    <input type="password" id="parentPass" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙˆØ§Ù„Ø¯" />
    <button onclick="registerSpecificUser('parent')">Ø«Ø¨Øª ÙˆØ§Ù„Ø¯</button>

    <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
  </div>

  <div class="teacher-panel hidden" id="teacher-panel">
    <h2>Ù¾Ù†Ù„ Ù…Ø¹Ù„Ù…</h2>
    <input type="text" id="studentName" placeholder="Ù†Ø§Ù… Ø´Ø§Ú¯Ø±Ø¯" />
    <input type="text" id="studentFather" placeholder="Ù†Ø§Ù… Ù¾Ø¯Ø± Ø´Ø§Ú¯Ø±Ø¯" />
    <select id="grade">
      <option disabled selected>Ø§Ù†ØªØ®Ø§Ø¨ ØµÙ†Ù</option>
    </select>
    <input type="text" id="subject" placeholder="Ù…Ø¶Ù…ÙˆÙ†" />
    <select id="performance">
      <option value="Ø¹Ø§Ù„ÛŒ">Ø¹Ø§Ù„ÛŒ</option>
      <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
      <option value="Ø¶Ø¹ÛŒÙ">Ø¶Ø¹ÛŒÙ</option>
    </select>
    <textarea id="extraNote" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ"></textarea>
    <input type="date" id="recordDate" />
    <button onclick="submitStudentData()">Ø«Ø¨Øª Ø¢Ù…Ø§Ø±</button>
    <div id="teacherRecords"></div>
    <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
  </div>

  <div class="parent-panel hidden" id="parent-panel">
    <h2>Ù¾Ù†Ù„ ÙˆØ§Ù„Ø¯ÛŒÙ†</h2>
    <div id="studentInfo"></div>
    <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase Ø®ÙˆØ¯Øª Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†
    const firebaseConfig = {
      apiKey: "AIzaSyARB3d-M1k9s-e-kN8WuURFERFHPpkFNHc",
      authDomain: "school-system-92711.firebaseapp.com",
      databaseURL: "https://school-system-92711-default-rtdb.firebaseio.com",
      projectId: "school-system-92711",
      storageBucket: "school-system-92711.appspot.com",
      messagingSenderId: "374437671805",
      appId: "1:374437671805:web:2f34a74fa1b1057df51214",
      measurementId: "G-LMZT4VGV4W"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙ†Ùâ€ŒÙ‡Ø§ Ø¯Ø± Ù„ÛŒØ³Øª Ø§Ù†ØªØ®Ø§Ø¨ ØµÙ†Ù
    const gradeSelect = document.getElementById("grade");
    for (let i = 1; i <= 10; i++) {
      gradeSelect.innerHTML += `<option value="${i}Ø§Ù„Ù">ØµÙ†Ù ${i} Ø§Ù„Ù</option><option value="${i}Ø¨">ØµÙ†Ù ${i} Ø¨</option>`;
    }

    let currentUser = null;
    let currentRole = null;

    // Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø§ÛŒØ¬Ø§Ø¯ Ù…Ø¯ÛŒØ± Ø§ÙˆÙ„ÛŒÙ‡ Ø¯Ø± Firebase Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø´Øª
    function ensureAdminExists() {
      db.ref("users/admin/Ù…Ø¯ÛŒØ±").get().then(snapshot => {
        if (!snapshot.exists()) {
          db.ref("users/admin/Ù…Ø¯ÛŒØ±").set("1234");
        }
      });
    }

    ensureAdminExists();

    async function handleLogin() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const userType = document.getElementById("userTypeSelect").value;

      if (!username || !password) {
        alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
        return;
      }

      try {
        const snapshot = await db.ref(`users/${userType}/${username}`).get();
        if (snapshot.exists()) {
          const storedPassword = snapshot.val();
          if (storedPassword === password) {
            currentUser = username;
            currentRole = userType;
            document.getElementById("login-panel").classList.add("hidden");
            document.getElementById(`${userType}-panel`).classList.remove("hidden");

            if (userType === "parent") {
              showStudentInfo();
            }
            if (userType === "teacher") {
              showTeacherRecords();
            }

            document.getElementById("username").value = "";
            document.getElementById("password").value = "";
          } else {
            alert("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.");
          }
        } else {
          alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.");
        }
      } catch (error) {
        alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³.");
        console.error(error);
      }
    }

    async function registerSpecificUser(role) {
      const username = document.getElementById(`${role}User`).value.trim();
      const password = document.getElementById(`${role}Pass`).value.trim();

      if (!username || !password) {
        alert("ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.");
        return;
      }

      try {
        const snapshot = await db.ref(`users/${role}/${username}`).get();
        if (snapshot.exists()) {
          alert("Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª.");
          return;
        }
        await db.ref(`users/${role}/${username}`).set(password);
        alert("Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.");
        document.getElementById(`${role}User`).value = "";
        document.getElementById(`${role}Pass`).value = "";
      } catch (error) {
        alert("Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ú©Ø§Ø±Ø¨Ø±.");
        console.error(error);
      }
    }

    async function submitStudentData() {
      const record = {
        name: document.getElementById("studentName").value.trim(),
        father: document.getElementById("studentFather").value.trim(),
        grade: document.getElementById("grade").value,
        subject: document.getElementById("subject").value.trim(),
        performance: document.getElementById("performance").value,
        note: document.getElementById("extraNote").value.trim(),
        date: document.getElementById("recordDate").value,
        parent: document.getElementById("studentFather").value.trim()
      };

      if (!record.name || !record.father || !record.grade || !record.subject || !record.date) {
        alert("ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.");
        return;
      }

      try {
        // Ú¯Ø±ÙØªÙ† Ø¢ÛŒØ¯ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø±Ú©ÙˆØ±Ø¯
        const newRecordRef = db.ref("records").push();
        await newRecordRef.set(record);

        alert("Ø¢Ù…Ø§Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.");

        showTeacherRecords();

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
        document.getElementById("studentName").value = "";
        document.getElementById("studentFather").value = "";
        document.getElementById("grade").selectedIndex = 0;
        document.getElementById("subject").value = "";
        document.getElementById("performance").value = "Ø¹Ø§Ù„ÛŒ";
        document.getElementById("extraNote").value = "";
        document.getElementById("recordDate").value = "";
      } catch (error) {
        alert("Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø¢Ù…Ø§Ø±.");
        console.error(error);
      }
    }

    async function showTeacherRecords() {
      const div = document.getElementById("teacherRecords");
      div.innerHTML = "<h3>Ø´Ø§Ú¯Ø±Ø¯Ø§Ù† Ø«Ø¨Øª Ø´Ø¯Ù‡:</h3>";

      try {
        const snapshot = await db.ref("records").get();
        if (snapshot.exists()) {
          const records = snapshot.val();
          // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø§Ù…â€ŒÙ‡Ø§ Ø¨Ø¯ÙˆÙ† ØªÚ©Ø±Ø§Ø±
          const names = [];
          for (const key in records) {
            if (!names.includes(records[key].name)) {
              names.push(records[key].name);
            }
          }
          names.forEach(name => {
            div.innerHTML += `<p>ğŸ‘¨â€ğŸ“ ${name}</p>`;
          });
        } else {
          div.innerHTML += "<p>Ù‡ÛŒÚ† Ø±Ú©ÙˆØ±Ø¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>";
        }
      } catch (error) {
        div.innerHTML += "<p>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§.</p>";
        console.error(error);
      }
    }

    async function showStudentInfo() {
      const div = document.getElementById("studentInfo");
      div.innerHTML = "";

      try {
        const snapshot = await db.ref("records").get();
        if (snapshot.exists()) {
          const records = snapshot.val();
          // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ Ø¨Ø±Ø§ÛŒ ÙˆØ§Ù„Ø¯ ÙØ¹Ù„ÛŒ
          const parentRecords = Object.values(records).filter(r => r.parent === currentUser);

          if (parentRecords.length === 0) {
            div.innerHTML = "<p>Ø¢Ù…Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙØ±Ø²Ù†Ø¯ Ø´Ù…Ø§ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>";
            return;
          }

          parentRecords.forEach(r => {
            div.innerHTML += `
              <div class="record">
                <p><strong>Ù†Ø§Ù…:</strong> ${r.name}</p>
                <p><strong>Ù†Ø§Ù… Ù¾Ø¯Ø±:</strong> ${r.father}</p>
                <p><strong>ØµÙ†Ù:</strong> ${r.grade}</p>
                <p><strong>Ù…Ø¶Ù…ÙˆÙ†:</strong> ${r.subject}</p>
                <p><strong>ÙˆØ¶Ø¹ÛŒØª:</strong> ${r.performance}</p>
                <p><strong>ØªØ§Ø±ÛŒØ®:</strong> ${r.date}</p>
                <p><strong>ØªÙˆØ¶ÛŒØ­Ø§Øª:</strong> ${r.note}</p>
              </div>
            `;
          });
        } else {
          div.innerHTML = "<p>Ø¢Ù…Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙØ±Ø²Ù†Ø¯ Ø´Ù…Ø§ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>";
        }
      } catch (error) {
        div.innerHTML = "<p>Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§.</p>";
        console.error(error);
      }
    }

    function logout() {
      ["admin-panel", "teacher-panel", "parent-panel"].forEach(p =>
        document.getElementById(p).classList.add("hidden")
      );
      document.getElementById("login-panel").classList.remove("hidden");
      currentUser = null;
      currentRole = null;
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }
  </script>
</body>
</html>
